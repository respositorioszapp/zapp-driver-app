{"ast":null,"code":"import { __awaiter } from \"tslib\";\nimport { Validators } from '@angular/forms';\nimport { MapPage } from '../map/map.page';\nimport { ImagePage } from '../image/image.page';\nimport { IonContent } from '@ionic/angular';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"src/app/services/ui.service\";\nimport * as i2 from \"src/app/services/photo.service\";\nimport * as i3 from \"src/app/services/auth.service\";\nimport * as i4 from \"src/app/services/request.service\";\nimport * as i5 from \"@angular/forms\";\nimport * as i6 from \"@angular/router\";\nimport * as i7 from \"src/app/services/network-status.service\";\nimport * as i8 from \"@angular/common\";\nimport * as i9 from \"@ionic/angular\";\nimport * as i10 from \"src/app/components/comment/comment.component\";\n\nfunction EventsPage_div_10_ion_img_1_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r7 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"ion-img\", 13);\n    i0.ɵɵlistener(\"click\", function EventsPage_div_10_ion_img_1_Template_ion_img_click_0_listener() {\n      i0.ɵɵrestoreView(_r7);\n      const item_r2 = i0.ɵɵnextContext().$implicit;\n      const ctx_r5 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r5.viewImage(item_r2.photo));\n    });\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const item_r2 = i0.ɵɵnextContext().$implicit;\n    i0.ɵɵproperty(\"src\", item_r2.photo);\n  }\n}\n\nfunction EventsPage_div_10_p_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"p\", 14)(1, \"span\", 15);\n    i0.ɵɵtext(2);\n    i0.ɵɵelement(3, \"ion-icon\", 16);\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    const item_r2 = i0.ɵɵnextContext().$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(item_r2.description);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"name\", !item_r2.sending ? \"checkmark-outline\" : \"checkmark-done-outline\");\n  }\n}\n\nfunction EventsPage_div_10_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 9);\n    i0.ɵɵtemplate(1, EventsPage_div_10_ion_img_1_Template, 1, 1, \"ion-img\", 10);\n    i0.ɵɵtemplate(2, EventsPage_div_10_p_2_Template, 4, 2, \"p\", 11);\n    i0.ɵɵelementStart(3, \"p\", 12);\n    i0.ɵɵtext(4);\n    i0.ɵɵpipe(5, \"date\");\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    const item_r2 = ctx.$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", item_r2.photo);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", item_r2.description);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\" \", i0.ɵɵpipeBind2(5, 3, item_r2.created_at, \"HH:MM\"), \"\");\n  }\n}\n\nfunction EventsPage_ion_toolbar_11_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r11 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"ion-toolbar\")(1, \"comment\", 17);\n    i0.ɵɵlistener(\"scroll\", function EventsPage_ion_toolbar_11_Template_comment_scroll_1_listener() {\n      i0.ɵɵrestoreView(_r11);\n      const ctx_r10 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r10.scrollToBottom());\n    });\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"order\", ctx_r1.order)(\"events\", ctx_r1.events)(\"latitude\", ctx_r1.latitude)(\"longitude\", ctx_r1.longitude);\n  }\n}\n\nexport let EventsPage = /*#__PURE__*/(() => {\n  class EventsPage {\n    constructor(ui, photo, auth, request, fb, router, network) {\n      this.ui = ui;\n      this.photo = photo;\n      this.auth = auth;\n      this.request = request;\n      this.fb = fb;\n      this.router = router;\n      this.network = network;\n      this.personal_information = this.fb.group({\n        comment: ['', Validators.required]\n      });\n      this.image = {\n        url: \"assets/imgs/img-default.jpg\",\n        format: \"\"\n      };\n      this.events = [];\n    }\n\n    get controls() {\n      return this.personal_information.controls;\n    }\n\n    ionViewWillEnter() {\n      if (this.network.getNetworkStatus().connected) {\n        const loader = this.ui.loading(\"Por favor espere...\");\n        this.request.get(`driver/events_per_driver/${this.order.id}/${this.auth.user.id}`).subscribe(res => __awaiter(this, void 0, void 0, function* () {\n          (yield loader).dismiss();\n          this.events = res.data;\n          this.events = this.events.map(e => {\n            return Object.assign(Object.assign({}, e), {\n              sending: true\n            });\n          });\n          console.log(\"Events\", res.data);\n          this.scrollToBottom();\n        }), err => __awaiter(this, void 0, void 0, function* () {\n          (yield loader).dismiss();\n          yield this.ui.presentAlert({\n            mode: 'ios',\n            header: 'No se ha podido cargar las eventualidades',\n            buttons: [{\n              text: 'Aceptar',\n              role: 'cancel',\n              cssClass: 'secondary',\n              handler: blah => {}\n            }]\n          });\n          console.log(\"Error\", err);\n        }));\n      } else {\n        this.ui.showToast(\"Verifique su conexión\", () => {\n          this.dismiss();\n        });\n      }\n    }\n\n    ngOnInit() {} // ngAfterViewChecked() {\n    //   this.scrollToBottom();\n    // }\n\n\n    scrollToBottom() {\n      return __awaiter(this, void 0, void 0, function* () {\n        try {\n          console.log(\"Scrolling...\");\n          yield this.myContent.scrollToBottom(100);\n        } catch (err) {}\n      });\n    }\n\n    viewMap(detail) {\n      const modal = this.ui.presentModal(MapPage, {\n        detail\n      });\n    }\n\n    viewImage(image) {\n      const modal = this.ui.presentModal(ImagePage, {\n        image\n      });\n    }\n\n    dismiss() {\n      this.ui.dismiss();\n    }\n\n    save() {\n      return __awaiter(this, void 0, void 0, function* () {\n        const {\n          comment\n        } = this.personal_information.value;\n        const data = new FormData();\n        const detail = this.order.details.find(d => d.status == 24);\n        data.append(\"order_detail_id\", detail.id);\n        data.append(\"latitude\", this.latitude.toString());\n        data.append(\"longitude\", this.longitude.toString());\n        data.append(\"description\", comment);\n\n        if (this.image.url != \"assets/imgs/img-default.jpg\") {\n          const dat = new Date().getTime();\n          yield this.ui.presentAlert({\n            mode: 'ios',\n            header: 'Imagen',\n            buttons: [{\n              text: 'Aceptar',\n              role: 'cancel',\n              cssClass: 'secondary',\n              handler: blah => {}\n            }]\n          });\n          const name_file1 = `${dat}_${this.auth.user.id}.${this.image.format}`;\n          const blob_image = this.photo.dataUrlToBlob(this.image.url);\n          const image_to_upload = this.photo.getFileImage(this.image.url, name_file1, this.image.format);\n          data.append('photo', blob_image);\n        }\n\n        data.append(\"user_id\", this.auth.user.id.toString());\n        const loader = this.ui.loading(\"Por favor espere...\");\n        this.request.post('driver/register_event', data).subscribe(res => __awaiter(this, void 0, void 0, function* () {\n          (yield loader).dismiss();\n          this.ui.showToast(\"Eventualidad registrada\", () => {\n            this.dismiss();\n          });\n        }), err => __awaiter(this, void 0, void 0, function* () {\n          console.log(\"Error\", err);\n          this.ui.showToast(\"Ha ocurrido un error\");\n        }));\n      });\n    }\n\n  }\n\n  EventsPage.ɵfac = function EventsPage_Factory(t) {\n    return new (t || EventsPage)(i0.ɵɵdirectiveInject(i1.UiService), i0.ɵɵdirectiveInject(i2.PhotoService), i0.ɵɵdirectiveInject(i3.AuthService), i0.ɵɵdirectiveInject(i4.RequestService), i0.ɵɵdirectiveInject(i5.FormBuilder), i0.ɵɵdirectiveInject(i6.Router), i0.ɵɵdirectiveInject(i7.NetworkStatusService));\n  };\n\n  EventsPage.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: EventsPage,\n    selectors: [[\"app-events\"]],\n    viewQuery: function EventsPage_Query(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵviewQuery(IonContent, 5, IonContent);\n      }\n\n      if (rf & 2) {\n        let _t;\n\n        i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.myContent = _t.first);\n      }\n    },\n    inputs: {\n      order: \"order\",\n      longitude: \"longitude\",\n      latitude: \"latitude\"\n    },\n    decls: 12,\n    vars: 4,\n    consts: [[\"color\", \"primary\", \"mode\", \"ios\", 2, \"position\", \"relative\"], [\"lines\", \"none\", \"color\", \"primary\"], [3, \"click\"], [\"slot\", \"start\", \"name\", \"arrow-back-outline\"], [2, \"width\", \"40px\", \"height\", \"40px\"], [\"src\", \"assets/imgs/avatar.svg\"], [\"forceOverscroll\", \"true\"], [\"style\", \"text-align: right;float:right;clear: both;\", 4, \"ngFor\", \"ngForOf\"], [4, \"ngIf\"], [2, \"text-align\", \"right\", \"float\", \"right\", \"clear\", \"both\"], [\"alt\", \"\", \"style\", \"width: 200px;\\n    height: 100px;\\n    margin-right: 10px;\\n    float: right;\\n    margin-bottom: 10px;\", 3, \"src\", \"click\", 4, \"ngIf\"], [\"style\", \"margin-bottom: 5px;font-size: 1em;margin-right: 10px;\", 4, \"ngIf\"], [1, \"grey-color-text\", 2, \"margin-bottom\", \"5px\", \"font-size\", \"1em\", \"margin-right\", \"10px\", \"clear\", \"both\"], [\"alt\", \"\", 2, \"width\", \"200px\", \"height\", \"100px\", \"margin-right\", \"10px\", \"float\", \"right\", \"margin-bottom\", \"10px\", 3, \"src\", \"click\"], [2, \"margin-bottom\", \"5px\", \"font-size\", \"1em\", \"margin-right\", \"10px\"], [2, \"text-align\", \"right\", \"background\", \"#49158c\", \"padding\", \"9px\", \"border-radius\", \"10px\", \"color\", \"white\", \"display\", \"block\", \"width\", \"max-content\", \"float\", \"right\", \"max-width\", \"300px\"], [3, \"name\"], [3, \"order\", \"events\", \"latitude\", \"longitude\", \"scroll\"]],\n    template: function EventsPage_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"ion-header\")(1, \"ion-toolbar\", 0)(2, \"ion-item\", 1)(3, \"ion-button\", 2);\n        i0.ɵɵlistener(\"click\", function EventsPage_Template_ion_button_click_3_listener() {\n          return ctx.dismiss();\n        });\n        i0.ɵɵelement(4, \"ion-icon\", 3);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(5, \"ion-avatar\", 4);\n        i0.ɵɵelement(6, \"ion-img\", 5);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(7, \"ion-title\");\n        i0.ɵɵtext(8);\n        i0.ɵɵelementEnd()()()();\n        i0.ɵɵelementStart(9, \"ion-content\", 6);\n        i0.ɵɵtemplate(10, EventsPage_div_10_Template, 6, 6, \"div\", 7);\n        i0.ɵɵelementEnd();\n        i0.ɵɵtemplate(11, EventsPage_ion_toolbar_11_Template, 2, 4, \"ion-toolbar\", 8);\n      }\n\n      if (rf & 2) {\n        i0.ɵɵadvance(8);\n        i0.ɵɵtextInterpolate2(\"\", ctx.order.customer_name, \" \", ctx.order.customer_last_name, \" \");\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"ngForOf\", ctx.events);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.order.status_order != 25 && ctx.order.status_order != 31);\n      }\n    },\n    dependencies: [i8.NgForOf, i8.NgIf, i9.IonAvatar, i9.IonButton, i9.IonContent, i9.IonHeader, i9.IonIcon, i9.IonImg, i9.IonItem, i9.IonToolbar, i9.IonTitle, i10.CommentComponent, i8.DatePipe]\n  });\n  return EventsPage;\n})();","map":null,"metadata":{},"sourceType":"module"}