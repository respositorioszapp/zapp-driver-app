{"ast":null,"code":"import { __awaiter } from \"tslib\";\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"src/app/services/auth.service\";\nimport * as i2 from \"src/app/services/ui.service\";\nimport * as i3 from \"src/app/services/request.service\";\nimport * as i4 from \"src/app/services/photo.service\";\nimport * as i5 from \"src/app/services/realtime.service\";\nimport * as i6 from \"@angular/router\";\nimport * as i7 from \"src/app/services/network-status.service\";\nimport * as i8 from \"src/app/services/days.service\";\nimport * as i9 from \"@angular/common\";\nimport * as i10 from \"@ionic/angular\";\n\nconst _c0 = function (a0, a1, a2, a3, a4) {\n  return {\n    \"bg-oro\": a0,\n    \"bg-silver\": a1,\n    \"bg-bronce\": a2,\n    \"bg-no-level\": a3,\n    \"bg-elite\": a4\n  };\n};\n\nexport let ProfilePage = /*#__PURE__*/(() => {\n  class ProfilePage {\n    constructor(auth, ui, request, photo, realtime, router, network, days) {\n      this.auth = auth;\n      this.ui = ui;\n      this.request = request;\n      this.photo = photo;\n      this.realtime = realtime;\n      this.router = router;\n      this.network = network;\n      this.days = days;\n      this.image = \"assets/imgs/avatar.svg\";\n      this.score = 0;\n      this.travels = 0;\n      this.antiquity = \"0 días\";\n      this.level = {\n        level_id: 1,\n        level_name: \"BRONCE\"\n      };\n    }\n\n    ngOnInit() {}\n\n    ionViewWillEnter() {\n      return __awaiter(this, void 0, void 0, function* () {\n        this.image = \"assets/imgs/avatar.svg\";\n\n        if (localStorage.getItem(\"currentDocuments\")) {\n          this.currentDOcuments = JSON.parse(localStorage.getItem(\"currentDocuments\"));\n        }\n\n        if (this.network.getNetworkStatus().connected) {\n          const loader = yield this.ui.loading(\"Por favor espere...\");\n          this.request.get(`driver/documents/${this.auth.user.id}`).subscribe(res => __awaiter(this, void 0, void 0, function* () {\n            const documents = res.data.documents;\n            const photo = documents.filter(d => d[\"document_type_id \"] == 21);\n\n            if (photo.length > 0) {\n              this.image = photo[photo.length - 1].url;\n              this.document_id = photo[photo.length - 1].document_id;\n              const obj = {\n                id: photo[photo.length - 1].id,\n                document_id: photo[photo.length - 1].document_id,\n                \"document_type \": photo[photo.length - 1][\"document_type \"],\n                \"document_type_id \": photo[photo.length - 1][\"document_type_id \"],\n                url: this.image\n              };\n\n              if (!this.currentDOcuments) {\n                this.currentDOcuments = [];\n              }\n\n              if (!this.currentDOcuments.find(d => d.id == obj.id)) {\n                this.currentDOcuments.push(obj);\n              } // if (localStorage.getItem(\"currentDocuments\")) {\n              //   if (!this.currentDOcuments.find(d => d.id == obj.id)) {\n              //     this.currentDOcuments.push(obj);\n              //   }\n              // }\n\n            }\n\n            (yield loader).dismiss();\n          }), err => __awaiter(this, void 0, void 0, function* () {\n            console.log(\"Error\", err);\n            (yield loader).dismiss();\n          }));\n          this.request.get(`driver/show_driver/${this.auth.user.id}`).subscribe(res => {\n            console.log(\"Data\", res.data);\n            this.score = res.data.score;\n            this.travels = res.data.total_services;\n            this.level = {\n              level_id: res.data.level_id,\n              level_name: res.data.level_id == 0 ? \"SIN NIVEL\" : res.data.level_name\n            };\n            this.auth.user.level_id = this.level.level_id;\n            this.auth.setUser(this.auth.user);\n            this.antiquity = this.days.formatDays(res.data.seniority_of_delivery);\n            console.log(\"Antiguedad\", this.antiquity);\n            console.log(\"Antiguedad fecha\", this.days.formatDaysWithDate(res.data.first_order_date));\n          });\n        } else {\n          this.ui.showToast(\"Verifique su conexión\");\n        }\n      });\n    }\n\n    logOut() {\n      return __awaiter(this, void 0, void 0, function* () {\n        yield this.ui.presentAlert({\n          mode: 'ios',\n          header: '¿Está seguro de cerrar la sesión?',\n          buttons: [{\n            text: 'No',\n            role: 'cancel',\n            cssClass: 'secondary',\n            handler: blah => {\n              console.log('Confirm Cancel: blah');\n            }\n          }, {\n            text: 'Sí',\n            handler: () => {\n              this.auth.logOut();\n            }\n          }]\n        });\n      });\n    }\n\n    goToPolicies() {\n      this.router.navigateByUrl(\"https://zapplogistica.com/politicas/\"); // location.href = \"https://zapplogistica.com/politicas/\"\n    }\n\n    takePhoto() {\n      return __awaiter(this, void 0, void 0, function* () {\n        try {\n          if (this.network.getNetworkStatus().connected) {\n            const image = yield yield this.photo.selectImageSource();\n            this.photo.imageSubject.subscribe(image => __awaiter(this, void 0, void 0, function* () {\n              if (Object.keys(image).length > 0) {\n                const current_photo = this.image == \"assets/imgs/avatar.svg\";\n                const current_photo_url = this.image;\n                this.image = image.dataUrl;\n                const url = !current_photo ? `driver/update_documents/${this.document_id}` : `driver/documents/${this.auth.user.id}/21`;\n                const dat = new Date().getTime();\n                const name_file1 = `${dat}_${this.auth.user.id}.${image.format}`;\n                const blob_image = this.photo.dataUrlToBlob(image.dataUrl);\n                const image_to_upload = this.photo.getFileImage(image.dataUrl, name_file1, image.format);\n                let data = new FormData();\n                data.append('photo', blob_image);\n                const loader = yield this.ui.loading(\"Por favor espere...\");\n                this.request.post(url, data).subscribe(res => __awaiter(this, void 0, void 0, function* () {\n                  (yield loader).dismiss();\n                  this.auth.person.photo = res.data.url;\n                  this.auth.setPerson(this.auth.person);\n                  const obj = {\n                    \"document_type \": \"Foto del conductor\",\n                    \"document_type_id \": 21,\n                    url: this.image\n                  };\n                  const v = this.currentDOcuments.find(d => d[\"document_type_id \"] == 21);\n                  const current_length = this.currentDOcuments.length;\n\n                  if (!v) {\n                    this.currentDOcuments.push(obj);\n                  } else {\n                    const index = this.currentDOcuments.findIndex(d => d == v);\n\n                    if (index != -1) {\n                      this.currentDOcuments[index].url = this.image;\n                    }\n                  }\n\n                  if (this.auth.user.verified == 0) {\n                    const res = Math.abs(Number(this.auth.vehicles.year) - new Date().getFullYear());\n\n                    if (localStorage.getItem(\"currentDocuments\")) {\n                      let length = res <= 2 ? 10 : 9;\n                      const min_length = res <= 2 ? 11 : 10;\n                      console.log(\"Length\", this.currentDOcuments.length);\n\n                      if (this.currentDOcuments.length >= length) {\n                        if (current_length < min_length) {\n                          this.realtime.getStatus().update({\n                            verified: this.auth.user.verified,\n                            documents: 1\n                          });\n                          yield this.ui.presentAlert({\n                            mode: 'ios',\n                            header: '¡Ha completado su registro!',\n                            buttons: [{\n                              text: 'Aceptar',\n                              handler: () => {\n                                this.router.navigate(['tabs/home']);\n                              }\n                            }]\n                          });\n                        } else {}\n                      } else {\n                        yield this.ui.presentAlert({\n                          mode: 'ios',\n                          header: 'Por favor complete sus documentos',\n                          buttons: [{\n                            text: 'Aceptar',\n                            handler: () => {\n                              this.router.navigate(['tabs/documents']);\n                            }\n                          }]\n                        });\n                      }\n                    }\n                  }\n\n                  console.log(\"Este es el res\", res);\n                }), err => __awaiter(this, void 0, void 0, function* () {\n                  (yield loader).dismiss();\n                  this.image = current_photo_url;\n                  this.ui.showToast(\"No se pudo subir la imagen\");\n                  console.log(\"Error\", err);\n                }));\n              }\n            }));\n          } else {\n            this.ui.showToast(\"Verifique su conexión\");\n          }\n        } catch (e) {\n          console.log(\"Error\", e);\n        }\n      });\n    }\n\n  }\n\n  ProfilePage.ɵfac = function ProfilePage_Factory(t) {\n    return new (t || ProfilePage)(i0.ɵɵdirectiveInject(i1.AuthService), i0.ɵɵdirectiveInject(i2.UiService), i0.ɵɵdirectiveInject(i3.RequestService), i0.ɵɵdirectiveInject(i4.PhotoService), i0.ɵɵdirectiveInject(i5.RealtimeService), i0.ɵɵdirectiveInject(i6.Router), i0.ɵɵdirectiveInject(i7.NetworkStatusService), i0.ɵɵdirectiveInject(i8.DaysService));\n  };\n\n  ProfilePage.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: ProfilePage,\n    selectors: [[\"app-profile\"]],\n    decls: 70,\n    vars: 14,\n    consts: [[\"color\", \"warning\"], [1, \"ion-padding\", \"ion-text-center\"], [\"src\", \"assets/imgs/logo-morado.png\", \"width\", \"100\"], [1, \"ion-text-center\", 2, \"position\", \"relative\"], [2, \"position\", \"relative\", \"display\", \"inline\"], [\"width\", \"70\", 2, \"border-radius\", \"50%\", \"width\", \"100px\", \"height\", \"100px\", 3, \"src\", \"click\"], [\"name\", \"camera\", 2, \"font-size\", \"1.8em\", \"margin-left\", \"-26px\", \"color\", \"#49158c\"], [1, \"ion-text-center\"], [2, \"display\", \"inline\"], [1, \"black-color-text\"], [1, \"grey-color-text\", 2, \"display\", \"block\"], [2, \"position\", \"relative\", \"width\", \"50%\", \"margin\", \"auto\", \"border-radius\", \"20px\", 3, \"ngClass\"], [2, \"margin-top\", \"10px\", \"margin-bottom\", \"2px\"], [\"name\", \"ribbon-outline\", 2, \"font-size\", \"1em\"], [1, \"ion-text-center\", 2, \"font-size\", \"1.5em\", \"font-weight\", \"bold\"], [2, \"display\", \"block\"], [\"size\", \"6\"], [\"fill\", \"clear\", \"size\", \"small\", 2, \"font-size\", \"1.5em\"], [\"name\", \"star\", 1, \"text-yellow\"], [\"name\", \"airplane\"], [\"expand\", \"block\", \"lines\", \"none\", \"routerLink\", \"/tabs/personal-information\"], [\"slot\", \"end\", \"name\", \"arrow-forward-outline\", \"color\", \"primary\"], [\"lines\", \"none\", \"routerLink\", \"/tabs/vehicle-information\"], [\"lines\", \"none\", \"routerLink\", \"/tabs/documents\"], [\"lines\", \"none\", \"routerLink\", \"/tabs/change-passwsord\"], [\"slot\", \"end\", \"name\", \"reload-outline\", \"color\", \"primary\"], [\"lines\", \"none\", \"routerLink\", \"/tabs/liquidation\"], [\"lines\", \"none\", \"routerLink\", \"/tabs/about\"], [\"name\", \"alert-circle-outline\", \"color\", \"primary\"], [\"lines\", \"none\", 3, \"click\"], [\"slot\", \"end\", \"name\", \"log-out-outline\", \"color\", \"primary\"]],\n    template: function ProfilePage_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"ion-content\", 0)(1, \"div\", 1);\n        i0.ɵɵelement(2, \"img\", 2);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(3, \"div\", 3)(4, \"div\", 4)(5, \"img\", 5);\n        i0.ɵɵlistener(\"click\", function ProfilePage_Template_img_click_5_listener() {\n          return ctx.takePhoto();\n        });\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(6, \"ion-icon\", 6);\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(7, \"ion-card\")(8, \"ion-card-header\")(9, \"ion-card-subtitle\", 7)(10, \"div\", 8)(11, \"span\", 9);\n        i0.ɵɵtext(12);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(13, \"span\", 10);\n        i0.ɵɵtext(14);\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(15, \"div\", 11)(16, \"h4\", 12);\n        i0.ɵɵtext(17);\n        i0.ɵɵelement(18, \"ion-icon\", 13);\n        i0.ɵɵelementEnd()()()();\n        i0.ɵɵelementStart(19, \"ion-card-content\")(20, \"h4\", 7);\n        i0.ɵɵtext(21, \"Antiguedad\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(22, \"h2\", 14);\n        i0.ɵɵtext(23);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(24, \"ion-grid\", 7)(25, \"ion-row\")(26, \"ion-col\")(27, \"span\", 15);\n        i0.ɵɵtext(28, \"Calificaci\\u00F3n\");\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(29, \"ion-col\")(30, \"span\", 15);\n        i0.ɵɵtext(31, \"Viajes realizados\");\n        i0.ɵɵelementEnd()()();\n        i0.ɵɵelementStart(32, \"ion-row\")(33, \"ion-col\", 16)(34, \"ion-button\", 17);\n        i0.ɵɵtext(35);\n        i0.ɵɵelement(36, \"ion-icon\", 18);\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(37, \"ion-col\", 16)(38, \"ion-button\", 17);\n        i0.ɵɵtext(39);\n        i0.ɵɵelement(40, \"ion-icon\", 19);\n        i0.ɵɵelementEnd()()()();\n        i0.ɵɵelementStart(41, \"ion-list\")(42, \"ion-item\", 20)(43, \"ion-label\");\n        i0.ɵɵtext(44, \"Datos Personales\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(45, \"ion-icon\", 21);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(46, \"ion-item\", 22)(47, \"ion-label\");\n        i0.ɵɵtext(48, \"Datos del veh\\u00EDculo\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(49, \"ion-icon\", 21);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(50, \"ion-item\", 23)(51, \"ion-label\");\n        i0.ɵɵtext(52, \"Documentos\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(53, \"ion-icon\", 21);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(54, \"ion-item\", 24)(55, \"ion-label\");\n        i0.ɵɵtext(56, \"Cambiar contrase\\u00F1a\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(57, \"ion-icon\", 25);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(58, \"ion-item\", 26)(59, \"ion-label\");\n        i0.ɵɵtext(60, \"Liquidaci\\u00F3n\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(61, \"ion-icon\", 25);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(62, \"ion-item\", 27)(63, \"ion-label\");\n        i0.ɵɵtext(64, \"Acerca de la aplicaci\\u00F3n\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(65, \"ion-icon\", 28);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(66, \"ion-item\", 29);\n        i0.ɵɵlistener(\"click\", function ProfilePage_Template_ion_item_click_66_listener() {\n          return ctx.logOut();\n        });\n        i0.ɵɵelementStart(67, \"ion-label\");\n        i0.ɵɵtext(68, \"Cerrar Sesi\\u00F3n\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(69, \"ion-icon\", 30);\n        i0.ɵɵelementEnd()()()()();\n      }\n\n      if (rf & 2) {\n        i0.ɵɵadvance(5);\n        i0.ɵɵproperty(\"src\", ctx.image, i0.ɵɵsanitizeUrl);\n        i0.ɵɵadvance(7);\n        i0.ɵɵtextInterpolate(ctx.auth.user.name);\n        i0.ɵɵadvance(2);\n        i0.ɵɵtextInterpolate(ctx.auth.user.email);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngClass\", i0.ɵɵpureFunction5(8, _c0, ctx.level.level_id == 3, ctx.level.level_id == 2, ctx.level.level_id == 1, ctx.level.level_id == 0, ctx.level.level_id == 4));\n        i0.ɵɵadvance(2);\n        i0.ɵɵtextInterpolate1(\"\", ctx.level.level_name, \" \");\n        i0.ɵɵadvance(6);\n        i0.ɵɵtextInterpolate(ctx.antiquity);\n        i0.ɵɵadvance(12);\n        i0.ɵɵtextInterpolate1(\" \", ctx.score, \" \");\n        i0.ɵɵadvance(4);\n        i0.ɵɵtextInterpolate1(\" \", ctx.travels, \" \");\n      }\n    },\n    dependencies: [i9.NgClass, i10.IonButton, i10.IonCard, i10.IonCardContent, i10.IonCardHeader, i10.IonCardSubtitle, i10.IonCol, i10.IonContent, i10.IonGrid, i10.IonIcon, i10.IonItem, i10.IonLabel, i10.IonList, i10.IonRow, i10.RouterLinkDelegate, i6.RouterLink],\n    styles: [\".text-yellow[_ngcontent-%COMP%]{color:#f6d000}.text-black[_ngcontent-%COMP%]{color:#000}.text-bronce[_ngcontent-%COMP%]{color:#895024}.text-silver[_ngcontent-%COMP%]{color:#bababa}.text-elite[_ngcontent-%COMP%]{color:#0381f2}.bg-no-level[_ngcontent-%COMP%]{background-color:#000;color:#fff}.bg-bronce[_ngcontent-%COMP%]{background-color:#895024;color:#fff}.bg-silver[_ngcontent-%COMP%]{background-color:#bababa;color:#fff}.bg-oro[_ngcontent-%COMP%]{background-color:#f6d000;color:#fff}.bg-elite[_ngcontent-%COMP%]{background-color:#0381f2;color:#fff}\"]\n  });\n  return ProfilePage;\n})();","map":null,"metadata":{},"sourceType":"module"}