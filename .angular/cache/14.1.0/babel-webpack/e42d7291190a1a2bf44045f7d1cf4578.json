{"ast":null,"code":"import { __awaiter } from \"tslib\";\nimport { FormGroup, FormControl, Validators } from '@angular/forms';\nimport { environment } from 'src/environments/environment';\nimport { Capacitor, Geolocation } from '@capacitor/core';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"src/app/services/storage.service\";\nimport * as i2 from \"../../../services/ui.service\";\nimport * as i3 from \"../../../services/auth.service\";\nimport * as i4 from \"@angular/router\";\nimport * as i5 from \"src/app/services/fcm.service\";\nimport * as i6 from \"src/app/services/request.service\";\nimport * as i7 from \"src/app/services/network-status.service\";\nimport * as i8 from \"@angular/common\";\nimport * as i9 from \"@angular/forms\";\nimport * as i10 from \"@ionic/angular\";\n\nfunction LoginPage_ion_item_9_ion_label_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"ion-label\");\n    i0.ɵɵtext(1, \"Email es requerido\");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction LoginPage_ion_item_9_ion_label_3_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"ion-label\");\n    i0.ɵɵtext(1, \"Debe ser un email v\\u00E1lido\");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction LoginPage_ion_item_9_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"ion-item\", 16);\n    i0.ɵɵelement(1, \"ion-icon\", 17);\n    i0.ɵɵtemplate(2, LoginPage_ion_item_9_ion_label_2_Template, 2, 0, \"ion-label\", 18);\n    i0.ɵɵtemplate(3, LoginPage_ion_item_9_ion_label_3_Template, 2, 0, \"ion-label\", 18);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.controls.email.errors.required);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.controls.email.errors.email);\n  }\n}\n\nfunction LoginPage_ion_item_14_ion_label_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"ion-label\");\n    i0.ɵɵtext(1, \"La contrase\\u00F1a es requerida\");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction LoginPage_ion_item_14_ion_label_3_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"ion-label\");\n    i0.ɵɵtext(1, \"La contrase\\u00F1a debe ser de 8 a 16 caracteres\");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction LoginPage_ion_item_14_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"ion-item\", 16);\n    i0.ɵɵelement(1, \"ion-icon\", 17);\n    i0.ɵɵtemplate(2, LoginPage_ion_item_14_ion_label_2_Template, 2, 0, \"ion-label\", 18);\n    i0.ɵɵtemplate(3, LoginPage_ion_item_14_ion_label_3_Template, 2, 0, \"ion-label\", 18);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.controls.password.errors.required);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.controls.password.errors.minlength || ctx_r1.controls.password.errors.maxlength);\n  }\n}\n\nexport let LoginPage = /*#__PURE__*/(() => {\n  class LoginPage {\n    constructor(storage, ui, auth, router, fcm, request, network) {\n      this.storage = storage;\n      this.ui = ui;\n      this.auth = auth;\n      this.router = router;\n      this.fcm = fcm;\n      this.request = request;\n      this.network = network;\n      this.view = false;\n      this.loginData = new FormGroup({\n        email: new FormControl('', [Validators.required, Validators.email]),\n        password: new FormControl('', [Validators.required, Validators.minLength(8), Validators.maxLength(20)])\n      });\n    }\n\n    ngOnInit() {\n      localStorage.removeItem(\"isLoggedIn\");\n      localStorage.removeItem(\"data\");\n      localStorage.removeItem(\"current_order\");\n      localStorage.removeItem(\"current_status\");\n      localStorage.removeItem(\"current_status\");\n      localStorage.removeItem(\"currentDocuments\");\n      localStorage.removeItem(\"longitude\");\n      localStorage.removeItem(\"latitude\");\n      localStorage.removeItem(\"watchPositionId\");\n    }\n\n    ionViewWillEnter() {\n      return __awaiter(this, void 0, void 0, function* () {});\n    }\n\n    get controls() {\n      return this.loginData.controls;\n    }\n\n    send() {\n      return __awaiter(this, void 0, void 0, function* () {\n        if (this.loginData.valid) {\n          let {\n            email,\n            password\n          } = this.loginData.value;\n\n          if (this.network.getNetworkStatus().connected) {\n            const loadier = this.ui.loading('Por favor espere...');\n            this.auth.login(email, password).subscribe(res => __awaiter(this, void 0, void 0, function* () {\n              (yield loadier).dismiss();\n              console.log(\"Rol id\", res.data);\n\n              if (res.data.role.id == 5) {\n                console.log(\"Version\", res.data.code_version);\n\n                if (Capacitor.platform !== 'web') {\n                  if (res.data.code_version == environment.VERSION_NAME) {\n                    this.storage.setObject('data', res.data);\n                    localStorage.setItem('isLoggedIn', 'si');\n                    localStorage.setItem('data', JSON.stringify(res.data));\n                    this.auth.setData();\n                    this.sendToken();\n                    this.router.navigate([`/tabs/home`]).then(() => __awaiter(this, void 0, void 0, function* () {\n                      if (this.auth.user.available != 0) {}\n                    }));\n                    localStorage.removeItem(\"current_order\");\n                  } else {\n                    yield this.ui.presentAlert({\n                      mode: 'ios',\n                      header: '¡Existe una nueva actualización!',\n                      message: 'Por favor actualizala, para obtener mejor rendimiento posible',\n                      buttons: [{\n                        text: 'Aceptar',\n                        role: 'cancel',\n                        cssClass: 'secondary',\n                        handler: blah => {\n                          location.href = environment.PLAY_STORE_URL;\n                        }\n                      }]\n                    });\n                  }\n                } else {\n                  this.storage.setObject('data', res.data);\n                  localStorage.setItem('isLoggedIn', 'si');\n                  localStorage.setItem('data', JSON.stringify(res.data));\n                  this.auth.setData();\n                  this.sendToken();\n                  this.router.navigate([`/tabs/home`]).then(() => __awaiter(this, void 0, void 0, function* () {\n                    if (this.auth.user.available != 0) {\n                      const position = yield Geolocation.getCurrentPosition({\n                        enableHighAccuracy: true\n                      }); // (await loader).dismiss();\n\n                      localStorage.setItem(\"latitude\", position.coords.latitude.toString());\n                      localStorage.setItem(\"longitude\", position.coords.longitude.toString());\n                    }\n                  }));\n                }\n              } else {\n                this.ui.showToast(\"El usuario existe, pero  no tiene acceso a esta aplicación\");\n              }\n            }), err => __awaiter(this, void 0, void 0, function* () {\n              (yield loadier).dismiss();\n\n              if (err.status == 400) {\n                this.ui.showToast(err.error.messages[0]);\n                return;\n              }\n\n              this.ui.showToast(\"Error de conexión\");\n            }));\n          } else {\n            this.ui.showToast(\"Verifique su conexión\");\n          }\n        }\n      });\n    }\n\n    setView() {\n      this.view = !this.view;\n    }\n\n    sendToken() {\n      if (localStorage.getItem('fcmId')) {\n        const obj = {\n          user_id: this.auth.user.id,\n          token: localStorage.getItem('fcmId'),\n          platform: \"mobile\"\n        };\n        this.request.post(\"get_token\", obj).subscribe(res => {}, err => {});\n      } else {}\n    }\n\n  }\n\n  LoginPage.ɵfac = function LoginPage_Factory(t) {\n    return new (t || LoginPage)(i0.ɵɵdirectiveInject(i1.StorageService), i0.ɵɵdirectiveInject(i2.UiService), i0.ɵɵdirectiveInject(i3.AuthService), i0.ɵɵdirectiveInject(i4.Router), i0.ɵɵdirectiveInject(i5.FcmService), i0.ɵɵdirectiveInject(i6.RequestService), i0.ɵɵdirectiveInject(i7.NetworkStatusService));\n  };\n\n  LoginPage.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: LoginPage,\n    selectors: [[\"app-login\"]],\n    decls: 21,\n    vars: 5,\n    consts: [[\"color\", \"warning\", 1, \"ion-padding\"], [1, \"ion-text-center\", \"margin-top-15vh\", \"ion-padding-bottom\"], [\"src\", \"assets/imgs/logo-morado.png\", \"width\", \"180\"], [1, \"border-radius\"], [\"novalidate\", \"\", 3, \"formGroup\", \"submit\"], [\"lines\", \"none\", 1, \"input-text\", \"ion-margin-top\"], [\"name\", \"person-circle\", \"slot\", \"start\"], [\"placeholder\", \"Email\", \"formControlName\", \"email\", \"required\", \"\"], [\"lines\", \"none\", \"class\", \"danger-color-text\", 4, \"ngIf\"], [\"lines\", \"none\", 1, \"input-text\", \"ion-margin-top\", \"ion-margin-bottom\"], [\"name\", \"lock-closed\", \"slot\", \"start\"], [\"placeholder\", \"Password\", \"formControlName\", \"password\", \"required\", \"\", 3, \"type\"], [\"slot\", \"end\", 3, \"name\", \"click\"], [\"fill\", \"clear\", \"expand\", \"block\", \"mode\", \"ios\", \"routerLink\", \"/signup/forgotpassword\", 1, \"grey-color\"], [\"type\", \"submit\", \"expand\", \"block\", \"mode\", \"ios\", \"color\", \"primary\", 1, \"ion-margin-bottom\"], [\"fill\", \"outline\", \"color\", \"primary\", \"expand\", \"block\", \"mode\", \"ios\", \"routerLink\", \"/signup\", 1, \"grey-color\"], [\"lines\", \"none\", 1, \"danger-color-text\"], [\"name\", \"alert-circle\", \"slot\", \"start\", 1, \"danger-color-text\"], [4, \"ngIf\"]],\n    template: function LoginPage_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"ion-content\", 0)(1, \"div\", 1);\n        i0.ɵɵelement(2, \"img\", 2);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(3, \"ion-card\", 3)(4, \"ion-card-content\")(5, \"form\", 4);\n        i0.ɵɵlistener(\"submit\", function LoginPage_Template_form_submit_5_listener() {\n          return ctx.send();\n        });\n        i0.ɵɵelementStart(6, \"ion-item\", 5);\n        i0.ɵɵelement(7, \"ion-icon\", 6)(8, \"ion-input\", 7);\n        i0.ɵɵelementEnd();\n        i0.ɵɵtemplate(9, LoginPage_ion_item_9_Template, 4, 2, \"ion-item\", 8);\n        i0.ɵɵelementStart(10, \"ion-item\", 9);\n        i0.ɵɵelement(11, \"ion-icon\", 10)(12, \"ion-input\", 11);\n        i0.ɵɵelementStart(13, \"ion-icon\", 12);\n        i0.ɵɵlistener(\"click\", function LoginPage_Template_ion_icon_click_13_listener() {\n          return ctx.setView();\n        });\n        i0.ɵɵelementEnd()();\n        i0.ɵɵtemplate(14, LoginPage_ion_item_14_Template, 4, 2, \"ion-item\", 8);\n        i0.ɵɵelementStart(15, \"ion-button\", 13);\n        i0.ɵɵtext(16, \" \\u00BFOlvidaste tu contrase\\u00F1a? \");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(17, \"ion-button\", 14);\n        i0.ɵɵtext(18, \" INICIAR SESION \");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(19, \"ion-button\", 15);\n        i0.ɵɵtext(20, \" REG\\u00CDSTRARSE \");\n        i0.ɵɵelementEnd()()()()();\n      }\n\n      if (rf & 2) {\n        i0.ɵɵadvance(5);\n        i0.ɵɵproperty(\"formGroup\", ctx.loginData);\n        i0.ɵɵadvance(4);\n        i0.ɵɵproperty(\"ngIf\", ctx.controls.email.dirty && ctx.controls.email.touched && ctx.controls.email.errors);\n        i0.ɵɵadvance(3);\n        i0.ɵɵproperty(\"type\", ctx.view ? \"text\" : \"password\");\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"name\", ctx.view ? \"eye-outline\" : \"eye-off-outline\");\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.controls.password.dirty && ctx.controls.password.touched && ctx.controls.password.errors);\n      }\n    },\n    dependencies: [i8.NgIf, i9.ɵNgNoValidate, i9.NgControlStatus, i9.NgControlStatusGroup, i9.RequiredValidator, i9.FormGroupDirective, i9.FormControlName, i10.IonButton, i10.IonCard, i10.IonCardContent, i10.IonContent, i10.IonIcon, i10.IonInput, i10.IonItem, i10.IonLabel, i10.TextValueAccessor, i10.RouterLinkDelegate, i4.RouterLink],\n    styles: [\".margin-top-15vh[_ngcontent-%COMP%]{margin-top:15vh}ion-icon[_ngcontent-%COMP%]{-webkit-margin-end:10px!important;margin-inline-end:10px!important;margin-top:7px;margin-bottom:7px}\"]\n  });\n  return LoginPage;\n})();","map":null,"metadata":{},"sourceType":"module"}