{"version":3,"sources":["webpack:///src/app/screens/forms/other-documents/other-documents.page.html","webpack:///src/app/screens/forms/other-documents/other-documents.page.scss","webpack:///src/app/screens/forms/other-documents/other-documents.page.ts"],"names":["OtherDocumentsPage","ui","fb","photo","auth","request","network","document","id","name","document_information","group","document_type","required","other_documents","img","setValue","getNetworkStatus","connected","loading","loader","get","subscribe","res","documents","data","dismiss","err","showToast","selectImageSource","imageSubject","image","url","user","dat","Date","getTime","name_file1","format","blob_image","dataUrlToBlob","image_to_upload","getFileImage","FormData","append","post","console","log","status","error","JSON","stringify","message","messages","length","presentAlert","mode","header","buttons","text","handler","valid","value","dataUrl","document_id","find","others","findIndex","o","push","selector","template"],"mappings":"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","file":"default~screens-forms-other-documents-other-documents-module~screens-screens-tabs-documents-documents-module-es5.js","sourcesContent":["export default \"<ion-header>\\n  <ion-toolbar color=\\\"primary\\\" style=\\\"position: relative;\\\" mode=\\\"ios\\\">\\n    <ion-title style=\\\"position: absolute; left: 5px;bottom:14px\\\">Otros\\n    </ion-title>\\n    <ion-button (click)=\\\"dismiss()\\\" style=\\\"position: absolute; right: 5px;bottom:5px\\\">\\n      <ion-icon slot=\\\"icon-only\\\" name=\\\"close-outline\\\"></ion-icon>\\n    </ion-button>\\n  </ion-toolbar>\\n</ion-header>\\n\\n<ion-content>\\n  <ng-container *ngIf=\\\"!img; else elseTemplate\\\">\\n    <form [formGroup]=\\\"document_information\\\">\\n      <ion-item lines=\\\"none\\\" class=\\\"input-text ion-margin-top\\\">\\n        <ion-select placeholder=\\\"Tipo de documento\\\" formControlName=\\\"document_type\\\" style=\\\"display: contents;\\\" required\\n          [selectedText]=\\\"document.name\\\">\\n          <ion-select-option *ngFor=\\\"let item of documents\\\" [value]=\\\"item.id\\\">{{item.name }}</ion-select-option>\\n        </ion-select>\\n      </ion-item>\\n    </form>\\n  </ng-container>\\n  <ng-template #elseTemplate>\\n    <ion-img [src] = \\\"img.url\\\" style=\\\"width: 100%;height: 300px;\\\" (click)=\\\"getFile()\\\">\\n\\n    </ion-img>\\n  </ng-template>\\n\\n\\n  <ion-button (click)=\\\"getFile()\\\" expand=\\\"block\\\" mode=\\\"ios\\\" color=\\\"primary\\\" class=\\\"ion-margin-bottom\\\">\\n    Subir documento\\n  </ion-button>\\n</ion-content>\";","export default \"\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IiIsImZpbGUiOiJzcmMvYXBwL3NjcmVlbnMvZm9ybXMvb3RoZXItZG9jdW1lbnRzL290aGVyLWRvY3VtZW50cy5wYWdlLnNjc3MifQ== */\";","import { Component, OnInit, Input } from '@angular/core';\nimport { UiService } from 'src/app/services/ui.service';\nimport { Validators, FormBuilder } from '@angular/forms';\nimport { PhotoService } from 'src/app/services/photo.service';\nimport { AuthService } from 'src/app/services/auth.service';\nimport { RequestService } from 'src/app/services/request.service';\n\nimport { NetworkStatusService } from 'src/app/services/network-status.service';\n\n@Component({\n  selector: 'app-other-documents',\n  templateUrl: './other-documents.page.html',\n  styleUrls: ['./other-documents.page.scss'],\n})\nexport class OtherDocumentsPage implements OnInit {\n  @Input() documents: any[]\n  document: any = {\n    id: \"\",\n    name: \"\"\n  }\n\n  @Input() others: any[]\n\n  @Input() img: any\n\n\n  document_information = this.fb.group({\n    document_type: ['', Validators.required],\n  },\n  );\n  other_documents: any[] = []\n  constructor(private ui: UiService, private fb: FormBuilder,\n    private photo: PhotoService,\n    private auth: AuthService,\n    private request: RequestService,\n    private network: NetworkStatusService\n  ) { }\n\n  async ngOnInit() {\n    if (this.img) {\n      this.document_information.setValue({\n        document_type: this.img[\"document_type_id \"]\n      })\n    } else {\n      if (this.network.getNetworkStatus().connected) {\n        const loader = await this.ui.loading(\"Por favor espere...\");\n        this.request.get('list/attributes?parameter_id=8').subscribe(async (res: any) => {\n          this.documents = res.data;\n          (await loader).dismiss();\n        }, async err => {\n          (await loader).dismiss();\n        })\n      } else {\n        this.ui.showToast(\"Verifique su conexión\")\n      }\n    }\n\n\n  }\n\n  dismiss() {\n    this.ui.dismiss()\n  }\n\n  async takePhoto() {\n    try {\n      if (this.network.getNetworkStatus().connected) {\n        await (await this.photo.selectImageSource());\n        this.photo.imageSubject.subscribe(image => {\n          const url = `driver/documents/${this.auth.user.id}/32`;\n          const dat = new Date().getTime();\n          const name_file1 = `${dat}_${this.auth.user.id}.${image.format}`;\n          const blob_image = this.photo.dataUrlToBlob(image.url);\n          const image_to_upload = this.photo.getFileImage(image.url, name_file1, image.format);\n          let data = new FormData();\n          data.append('photo', blob_image);\n          this.request.post(url, data).subscribe(async (res: any) => {\n            console.log(\"Este es el res\", res)\n            this.ui.showToast(\"Documento subido\", () => {\n              this.dismiss();\n            })\n          },\n            async (err: any) => {\n              if(err.status == 400){\n                const error = JSON.stringify(err.error);\n                const message = err.error.messages ? err.error.messages[0].length == 1 ? err.error.messages :err.error.messages[0] : 'No hay mensaje'\n                await this.ui.presentAlert({\n                  mode: 'ios',\n                  header: message,\n                  buttons: [\n                    {\n                      text: 'Aceptar',\n                      handler: () => { }\n  \n                    }\n                  ]\n                })\n              }\n              \n            })\n        })\n      } else {\n        this.ui.showToast(\"Verifique su conexión\")\n      }\n\n\n    } catch (err) {\n      console.log(\"Error\", err)\n    }\n\n  }\n\n  async getFile() {\n    if (this.document_information.valid) {\n      const { document_type } = this.document_information.value\n      if (this.network.getNetworkStatus().connected) {\n        await (await this.photo.selectImageSource());\n        this.photo.imageSubject.subscribe(async (image) => {\n          if (this.img) {\n            this.img.url = image.dataUrl;\n          }\n          const url = this.img ? `driver/update_documents/${this.img.document_id}` : `driver/documents/${this.auth.user.id}/${document_type}`;\n          let data = new FormData();\n          const dat = new Date().getTime();\n          const name_file1 = `${dat}_${this.auth.user.id}.${image.format}`;\n          const blob_image = this.photo.dataUrlToBlob(image.dataUrl);\n          const image_to_upload = this.photo.getFileImage(image.dataUrl, name_file1, image.format);\n          data.append('photo', blob_image);\n          const loader = await this.ui.loading(\"Por favor espere...\");\n          this.request.post(url, data).subscribe(async (res: any) => {\n            (await loader).dismiss()\n            if (this.img) {\n              const find = this.others.findIndex(o => o.document_id == this.img);\n              if (find != -1) {\n                this.others[find] = this.img;\n              }\n            } else {\n              this.others.push({\n                url: image.dataUrl,\n              })\n            }\n            await this.ui.presentAlert({\n              mode: 'ios',\n              header: '¡Archivo subido con éxito!',\n              buttons: [\n                {\n                  text: 'Aceptar',\n                  handler: () => { }\n                }\n              ]\n            })\n          }, async (err: any) => {\n            (await loader).dismiss()\n            if(err.status == 400){\n              const error = JSON.stringify(err.error);\n              const message = err.error.messages ? err.error.messages[0].length == 1 ? err.error.messages :err.error.messages[0] : 'No hay mensaje'\n              await this.ui.presentAlert({\n                mode: 'ios',\n                header: message,\n                buttons: [\n                  {\n                    text: 'Aceptar',\n                    handler: () => { }\n\n                  }\n                ]\n              })\n            }\n            console.log(\"Err\", err)\n          })\n        })\n      }else{\n        this.ui.showToast(\"Verifique su conexión\");  \n      }\n    }else{\n      this.ui.showToast(\"Debe escoger un tipo de documento\");\n    }\n  }\n\n}\n"]}